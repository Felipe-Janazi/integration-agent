## üöÄ Automa√ß√£o BDD ‚Üí Pytest‚ÄëBDD (Python)

> **Obs.**  
> Os exemplos abaixo s√£o *esqueleto* ‚Äì n√£o h√° seletores reais, nem l√≥gica de neg√≥cio, apenas a estrutura que voc√™ precisar√° preencher para transformar os *features* BDD em testes automatizados com Selenium + pytest‚Äëbdd.

---

### 1. Estrutura de Diret√≥rios

```
paraBank/
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py                 # fixtures globais (webdriver, fixtures de dados, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_page.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signup_page.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login_page.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard_page.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transfer_page.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loan_page.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ payment_page.py
‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cadastro.feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ saldo_extrato.feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transferencia.feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ solicitacao_emprestimo.feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pagamento_contas.feature
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ navegacao_uso.feature
‚îÇ   ‚îî‚îÄ‚îÄ steps/
‚îÇ       ‚îú‚îÄ‚îÄ cadastro_steps.py
‚îÇ       ‚îú‚îÄ‚îÄ login_steps.py
‚îÇ       ‚îú‚îÄ‚îÄ saldo_extrato_steps.py
‚îÇ       ‚îú‚îÄ‚îÄ transferencia_steps.py
‚îÇ       ‚îú‚îÄ‚îÄ solicitacao_emprestimo_steps.py
‚îÇ       ‚îú‚îÄ‚îÄ pagamento_contas_steps.py
‚îÇ       ‚îî‚îÄ‚îÄ navegacao_uso_steps.py
‚îî‚îÄ‚îÄ requirements.txt
```

> **Tip** ‚Äì Use *Page Objects* (`pages/*.py`) para manter a manuten√ß√£o de seletores longe dos steps.

---

### 2. `requirements.txt`

```txt
pytest==8.0.0
pytest-bdd==4.1.0
selenium==4.22.0
webdriver-manager==4.0.1
```

Instale tudo:

```bash
pip install -r requirements.txt
```

---

### 3. `conftest.py`

```python
import pytest
from selenium import webdriver
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.chrome.service import Service

@pytest.fixture(scope="session")
def driver():
    """Inicializa um driver Selenium (Chrome)."""
    service = Service(ChromeDriverManager().install())
    options = webdriver.ChromeOptions()
    options.add_argument("--headless")          # Remova se quiser ver o navegador
    options.add_argument("--disable-gpu")
    driver = webdriver.Chrome(service=service, options=options)
    driver.implicitly_wait(5)
    yield driver
    driver.quit()

# Se desejar usar fixtures de dados (ex.: criar usu√°rios via API) fa√ßa aqui.
```

---

### 4. Page Objects (exemplo: `signup_page.py`)

```python
from selenium.webdriver.common.by import By

class SignUpPage:
    URL = "https://parabank.com/signup"

    # Seletores (exemplo)
    _name = (By.ID, "name")
    _address = (By.ID, "address")
    _city = (By.ID, "city")
    _state = (By.ID, "state")
    _zip = (By.ID, "zip")
    _phone = (By.ID, "phone")
    _email = (By.ID, "email")
    _password = (By.ID, "password")
    _create_btn = (By.ID, "createAccount")

    def __init__(self, driver):
        self.driver = driver

    def open(self):
        self.driver.get(self.URL)

    def fill_form(self, data: dict):
        for field, selector in {
            "Nome": self._name,
            "Endere√ßo": self._address,
            "Cidade": self._city,
            "Estado": self._state,
            "CEP": self._zip,
            "Telefone": self._phone,
            "Email": self._email,
            "Senha": self._password,
        }.items():
            if field in data:
                self.driver.find_element(*selector).clear()
                self.driver.find_element(*selector).send_keys(data[field])

    def click_create(self):
        self.driver.find_element(*self._create_btn).click()

    def get_flash_message(self):
        return self.driver.find_element(By.CSS_SELECTOR, ".alert").text
```

> **Obs.** Fa√ßa o mesmo para as demais p√°ginas: `LoginPage`, `DashboardPage`, `TransferPage`, `LoanPage`, `PaymentPage`.

---

### 5. Feature Files

> **Exemplo**: `cadastro.feature`

```gherkin
Feature: Cadastro de Usu√°rio (ParaBank)
  Como usu√°rio do ParaBank
  Quero criar uma conta
  Para que eu possa utilizar os servi√ßos banc√°rios.

  Scenario: Cadastro de usu√°rio com todos os campos obrigat√≥rios preenchidos
    Given que eu estou na p√°gina de cadastro
    When eu preencho todos os campos obrigat√≥rios com valores v√°lidos
      | Campo        | Valor                   |
      | Nome         | Jo√£o Silva              |
      | Endere√ßo     | Rua A, 123              |
      | Cidade       | S√£o Paulo               |
      | Estado       | SP                      |
      | CEP          | 01234-567                |
      | Telefone     | (11) 98765-4321          |
      | Email        | joao.silva@example.com  |
      | Senha        | SenhaSegura123!         |
    And eu clico em ‚ÄúCriar Conta‚Äù
    Then devo ver a mensagem de confirma√ß√£o ‚ÄúRegistro conclu√≠do com sucesso‚Äù
    And devo poder acessar a tela de login

  Scenario: Cadastro de usu√°rio com telefone inv√°lido
    Given que eu estou na p√°gina de cadastro
    When eu preencho todos os campos obrigat√≥rios
      | Campo        | Valor           |
      | Nome         | Maria Pereira   |
      | Endere√ßo     | Av B, 456       |
      | Cidade       | Rio de Janeiro  |
      | Estado       | RJ              |
      | CEP          | 12345-678        |
      | Telefone     | 123abc          |
      | Email        | maria@exemplo.com |
      | Senha        | Senha1234!      |
    And eu clico em ‚ÄúCriar Conta‚Äù
    Then devo ver a mensagem de erro ‚ÄúTelefone inv√°lido, por favor insira apenas n√∫meros‚Äù
```

> Copie a estrutura (apenas alterando os textos) para os demais arquivos de feature listados.

---

### 6. Steps ‚Äì `cadastro_steps.py`

```python
import pytest
from pytest_bdd import scenario, given, when, then, parsers

from pages.signup_page import SignUpPage

# --------------------------------------------
#  Feature: Cadastro de Usu√°rio (ParaBank)
# --------------------------------------------

@pytest.mark.usefixtures("driver")
@scenario("features/cadastro.feature", "Cadastro de usu√°rio com todos os campos obrigat√≥rios preenchidos")
def test_cadastro_completo(driver):
    pass

@pytest.mark.usefixtures("driver")
@scenario("features/cadastro.feature", "Cadastro de usu√°rio com telefone inv√°lido")
def test_cadastro_telefone_invalido(driver):
    pass


# ---------- Givens ----------

@given("que eu estou na p√°gina de cadastro")
def open_signup(driver):
    page = SignUpPage(driver)
    page.open()
    return page

# ---------- Whens ----------

@when(parsers.parse('eu preencho todos os campos obrigat√≥rios com valores v√°lidos\n{table}'))
def preenche_cadastro_completo(driver, table, open_signup):
    """
    table: objeto pandas DataFrame (colunas Campo/Valor)
    """
    dados = {row["Campo"]: row["Valor"] for _, row in table.iterrows()}
    open_signup.fill_form(dados)

@when(parsers.parse('eu preencho todos os campos obrigat√≥rios\n{table}'))
def preenche_cadastro_valores(driver, table, open_signup):
    dados = {row["Campo"]: row["Valor"] for _, row in table.iterrows()}
    open_signup.fill_form(dados)

@when('eu clico em ‚ÄúCriar Conta‚Äù')
def clicar_criar_conta(open_signup):
    open_signup.click_create()

# ---------- Thens ----------

@then('devo ver a mensagem de confirma√ß√£o ‚ÄúRegistro conclu√≠do com sucesso‚Äù')
def ver_mensagem_confirmacao(open_signup):
    assert "Registro conclu√≠do com sucesso" in open_signup.get_flash_message()

@then('devo poder acessar a tela de login')
def verificar_login_page(driver):
    # Um exemplo simples ‚Äì substitua pelo seu selector de login
    assert "Login" in driver.title

@then('devo ver a mensagem de erro ‚ÄúTelefone inv√°lido, por favor insira apenas n√∫meros‚Äù')
def ver_mensagem_erro_telefone(open_signup):
    assert "Telefone inv√°lido" in open_signup.get_flash_message()
```

> **Notas**  
> 1. `parsers.parse` permite capturar a tabela como *pandas DataFrame* (pytest‚Äëbdd j√° converte).  
> 2. Se voc√™ preferir usar `@given`, `@when`, `@then` sem par√¢metros, basta passar o texto exato.  
> 3. Crie arquivos *steps* semelhantes para cada feature (login, saldo, transfer√™ncia, etc.).

---

### 7. Exemplo de Steps para **Login** ‚Äì `login_steps.py`

```python
import pytest
from pytest_bdd import scenario, given, when, then, parsers

from pages.login_page import LoginPage

@pytest.mark.usefixtures("driver")
@scenario("features/login.feature", "Login com credenciais v√°lidas")
def test_login_credenciais_validas(driver):
    pass

@pytest.mark.usefixtures("driver")
@scenario("features/login.feature", "Login com credenciais inv√°lidas ‚Äì e‚Äëmail n√£o cadastrado")
def test_login_email_nao_cadastrado(driver):
    pass

@pytest.mark.usefixtures("driver")
@scenario("features/login.feature", "Login com credenciais inv√°lidas ‚Äì senha incorreta")
def test_login_senha_incorreta(driver):
    pass


# -------- Givens --------

@given("que eu estou na p√°gina de login")
def abrir_login(driver):
    page = LoginPage(driver)
    page.open()
    return page


# -------- Whens --------

@when(parsers.parse('eu informo meu e‚Äëmail "{email}" e senha "{senha}"'))
def informar_login(driver, email, senha, abrir_login):
    abrir_login.login(email, senha)


@when('eu clico em ‚ÄúEntrar‚Äù')
def clicar_entrar(abrir_login):
    abrir_login.click_enter()


# -------- Thens --------

@then('devo ser redirecionado para a p√°gina inicial da minha conta')
def verificar_redirecionamento(driver):
    # Exemplo: esperar t√≠tulo ou URL espec√≠fica
    assert "Dashboard" in driver.title


@then('devo ver o cabe√ßalho ‚ÄúBem‚Äëvindo, Jo√£o‚Äù')
def verificar_cabecalho(driver):
    assert "Bem‚Äëvindo, Jo√£o" in driver.page_source


@then('devo ver a mensagem de erro ‚ÄúE‚Äëmail ou senha inv√°lidos‚Äù')
def verificar_mensagem_erro(driver):
    login_page = LoginPage(driver)
    assert "E‚Äëmail ou senha inv√°lidos" in login_page.get_error_message()
```

> Repita a l√≥gica para **saldo/extra**, **transfer√™ncia**, **empr√©stimo**, **pagamento**, **navega√ß√£o**.  
> Cada feature possui seu *scenario* e os *steps* correspondentes.

---

### 8. Como executar

```bash
# Na raiz do projeto
pytest tests
```

O pytest‚Äëbdd ir√° ler os arquivos `.feature`, mapear os passos com os *functions* e executar os testes.

---

## üìå Boas pr√°ticas

1. **Page Objects**  
   Mantenha a l√≥gica de intera√ß√£o com a UI dentro das classes de p√°gina. Assim, se os seletores mudarem, s√≥ precisa ajustar uma vez.

2. **Data‚ÄëDriven**  
   Use arquivos de dados (`csv`, `json`) ou *fixtures* para gerar usu√°rios aleat√≥rios ‚Äì evita repetir dados est√°ticos em cada teste.

3. **Assertas**  
   Use `assert` de forma clara ‚Äì mensagem de erro √∫til quando algo falha.

4. **Headless vs Visual**  
   Para debugging, remova `options.add_argument("--headless")` e rode o navegador de forma vis√≠vel.

5. **Parallel**  
   Se precisar, configure o pytest para rodar testes em paralelo (ex.: `pytest -n 4` com `pytest-xdist`).

---

> **Pr√≥ximo passo**: Preencher os seletores reais nas classes de p√°gina, adaptar as a√ß√µes (ex.: `login()`, `click_enter()`, `get_error_message()`), e, se desejar, adicionar *hooks* de *setup/teardown* para criar e deletar usu√°rios via API antes do teste.  

Boa codifica√ß√£o! üöÄ